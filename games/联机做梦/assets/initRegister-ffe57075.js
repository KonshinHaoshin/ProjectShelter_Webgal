import{r as B,W as b,C as z,b as D,a as G,S as U,B as X,R as Y}from"./index-1b91f010.js";const $=(C,T,v,I,E,M,m)=>{const w=b.gameplay.pixiStage,S=T==="foreground"?w.foregroundEffectsContainer:w.backgroundEffectsContainer,p=b.stageWidth,a=b.stageHeight,c=new z;c.angle=m;const y=c.rotation,k=Math.abs(Math.cos(y)),d=Math.abs(Math.sin(y)),i=p*k+a*d,f=p*d+a*k;c.width=i,c.height=f,c.pivot.set(i/2,f/2),c.position.set(p/2,a/2),S.addChild(c);const r=new D(E,{scale:!0,position:!0,rotation:!0,uvs:!1,alpha:!0});c.addChild(r);const u=[],P=G.from("./game/tex/cherryBlossoms.webp"),x=(h,l)=>h+Math.random()*(l-h);for(let h=0;h<E;h++){const l=Math.random()*Math.PI*2,n=U.from(P);n.anchor.set(.5),n.x=Math.random()*i,n.y=Math.random()*f,n.rotation=Math.random()*Math.PI*2,n.scale.set(Math.cos(l)*M,Math.sin(l)*M),n.speed=(x(.5,2)+x(.1,1))*v,n.rotationSpeed=Math.random()*.015*(Math.random()<.5?1:-1),n.positionPhase=Math.random()*Math.PI*2,n.scalePhase=l,u.push(n),r.addChild(n)}function H(h){const l=Date.now()/1e3;for(const n of u){const W=Math.sin(l+n.positionPhase)*I;n.x+=W*h,n.y+=n.speed*h,n.rotation+=n.rotationSpeed*h;const A=Math.cos(l+n.scalePhase)*M,F=Math.sin(l+n.scalePhase)*M;n.scale.set(A,F);const R=Math.abs(n.width*M),t=Math.abs(n.height*M);n.x+R/2<-i?n.x=i+R/2:n.x-R/2>i&&(n.x=-i-R/2),n.y-t/2>f&&(n.x=Math.random()*i,n.y=-Math.random()*50-t,n.positionPhase=Math.random()*Math.PI*2,n.scalePhase=Math.random()*Math.PI*2,n.speed=(x(.5,2)+x(.1,1))*v,n.rotationSpeed=Math.random()*.015*(Math.random()<.5?1:-1))}}return w.registerAnimation({setStartState:()=>{},setEndState:()=>{},tickerFunc:H},C),{container:c,tickerKey:C}};B("cherryBlossoms",{fg:()=>$("cherry-blossoms-foreground-ticker","foreground",2,3,100,.05,0),bg:()=>$("cherry-blossoms-background-ticker","background",1,2,300,.025,0)});const L=(C,T,v,I,E,M)=>{const m=b.gameplay.pixiStage;m.currentApp;const w=T==="foreground"?m.foregroundEffectsContainer:m.backgroundEffectsContainer,S=b.stageWidth,p=b.stageHeight,a=new z;a.angle=M;const c=a.rotation,y=Math.abs(Math.cos(c)),k=Math.abs(Math.sin(c)),d=S*y+p*k,i=S*k+p*y;a.width=d,a.height=i,a.pivot.set(d/2,i/2),a.position.set(S/2,p/2),w.addChild(a);const f=new D(I,{scale:!0,position:!0,rotation:!0,alpha:!0,uvs:!1});a.addChild(f);const r=[],u=[],P="./game/tex/rain.png",x=128,H=640,h=5,l=[10,5,2,2,1],n=t=>{if(!t||t.length===0)return 0;const e=t.reduce((o,g)=>o+g,0);if(e<=0)return Math.floor(Math.random()*t.length);let s=Math.random()*e;for(let o=0;o<t.length;o++){if(s<t[o])return o;s-=t[o]}return t.length-1},W=(t,e=!1)=>{const s=Math.random()*.5+.5;t.scale.set(E*s),t.anchor.set(.5),e?(t.x=Math.random()*d,t.y=Math.random()*i):(t.x=Math.random()*d,t.y=-Math.random()*50-t.height),t.alpha=Math.random()*.5+.5,t.vy=(Math.random()*.4+.8)*v},A=()=>{let t;r.length===h?t=n(l):t=Math.floor(Math.random()*r.length),t=Math.max(0,Math.min(t,r.length-1));const e=new U(r[t]);return W(e,!0),e},F=t=>{for(const e of u)e.y+=e.vy*t,(e.y-e.height/2>i||e.x<-e.width||e.x>d+e.width)&&W(e,!1)};return(()=>{for(r.length=0;u.length>0;)u.pop();f.removeChildren();const t=X.from(P),e=()=>{var s;if(t.valid)for(let o=0;o<h;o++){const g=new Y(o*x,0,x,H);r.push(new G(t,g))}if(r.length===0){console.error("Failed to create any raindrop textures. Cannot create sprites.");return}(s=r[0])!=null&&s.valid||console.warn("First raindrop texture is invalid after creation. Sprites might not render correctly.");for(let o=0;o<I;o++){const g=A();f.addChild(g),u.push(g)}m.registerAnimation({setStartState:()=>{},setEndState:()=>{},tickerFunc:F},C)};t.valid?e():(t.once("loaded",()=>{e()}),t.once("error",s=>{console.error(`Error loading base texture ${P}:`,s),e()}))})(),{container:a,tickerKey:C}};B("rain",{fg:()=>L("rain-foreground-ticker","foreground",30,50,.4,1),bg:()=>L("rain-background-ticker","background",20,150,.3,1)});const _=(C,T,v,I,E,M)=>{const m=b.gameplay.pixiStage;m.currentApp;const w=T==="foreground"?m.foregroundEffectsContainer:m.backgroundEffectsContainer,S=b.stageWidth,p=b.stageHeight,a=new z;a.angle=M;const c=a.rotation,y=Math.abs(Math.cos(c)),k=Math.abs(Math.sin(c)),d=S*y+p*k,i=S*k+p*y;a.width=d,a.height=i,a.pivot.set(d/2,i/2),a.position.set(S/2,p/2),w.addChild(a);const f=new D(I,{scale:!0,position:!0,rotation:!0,alpha:!0,uvs:!1});a.addChild(f);const r=[],u=[],P="./game/tex/snow.png",x=128,H=128,h=10,l=[10,2,2,2,1,1,1,2,2,2],n=t=>{if(!t||t.length===0)return 0;const e=t.reduce((o,g)=>o+g,0);if(e<=0)return Math.floor(Math.random()*t.length);let s=Math.random()*e;for(let o=0;o<t.length;o++){if(s<t[o])return o;s-=t[o]}return t.length-1},W=(t,e=!1)=>{const s=Math.random()*.5+.5;t.scale.set(E*s),t.anchor.set(.5),e?(t.x=Math.random()*d,t.y=Math.random()*i):(t.x=Math.random()*d,t.y=-Math.random()*50-t.height),t.alpha=Math.random()*.2+.8,t.vy=(Math.random()*.4+.8)*v,t.vx=(Math.random()-.5)*.25*v,t.rotationSpeed=(Math.random()-.5)*.005},A=()=>{let t;r.length===h?t=n(l):t=Math.floor(Math.random()*r.length),t=Math.max(0,Math.min(t,r.length-1));const e=new U(r[t]);return W(e,!0),e},F=t=>{for(const e of u)e.y+=e.vy*t,e.x+=e.vx*t,e.rotation+=e.rotationSpeed*t,(e.y-e.height/2>i||e.x<-e.width||e.x>d+e.width)&&W(e,!1)};return(()=>{for(r.length=0;u.length>0;)u.pop();f.removeChildren();const t=X.from(P),e=()=>{var s;if(t.valid)for(let o=0;o<h;o++){const g=new Y(o*x,0,x,H);r.push(new G(t,g))}if(r.length===0){console.error("Failed to create any snowflake textures. Cannot create sprites.");return}(s=r[0])!=null&&s.valid||console.warn("First snowflake texture is invalid after creation. Sprites might not render correctly.");for(let o=0;o<I;o++){const g=A();f.addChild(g),u.push(g)}m.registerAnimation({setStartState:()=>{},setEndState:()=>{},tickerFunc:F},C)};t.valid?e():(t.once("loaded",()=>{e()}),t.once("error",s=>{console.error(`Error loading base texture ${P}:`,s),e()}))})(),{container:a,tickerKey:C}};B("snow",{fg:()=>_("snow-foreground-ticker","foreground",3,250,.4,0),bg:()=>_("snow-background-ticker","background",1,750,.2,0)});B("heavySnow",{fg:()=>_("heavy-snow-foreground-ticker","foreground",20,1e3,.6,-75),bg:()=>_("heavy-snow-background-ticker","background",10,2e3,.3,-80)});
