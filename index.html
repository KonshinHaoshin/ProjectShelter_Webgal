<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>庇护所 WebGAL 收录</title>
    <link rel="stylesheet" href="style.css?v=1.1">
</head>
<body>
    <div class="layout">
        <header id="header" class="header">
            <div class="header-content">
                <a href="/" class="logo">
                    <img src="icons/favicon01.png" alt="Logo" class="logo-img">
                    <h1>Shelter</h1>
                </a>
                
                <nav class="nav">
                    <a href="https://shelter.net.cn/public-articles" class="nav-link" target="_blank">文章</a>
                    <a href="/" class="nav-link">WebGAL</a>
                    <a href="https://github.com/open-webgal/WebGAL" class="nav-link" target="_blank">GitHub</a>
                </nav>

                <div class="mobile-header-actions">
                    <button id="menu-toggle" class="mobile-menu-btn" aria-label="菜单">
                        <span class="hamburger">
                            <span></span>
                            <span></span>
                            <span></span>
                        </span>
                    </button>
                </div>
            </div>
        </header>

        <div id="menu-overlay" class="mobile-menu-overlay"></div>
        <div id="menu-drawer" class="mobile-menu-drawer">
            <nav class="mobile-nav">
                <a href="https://shelter.net.cn/public-articles" class="mobile-nav-link" target="_blank">文章</a>
                <a href="/" class="mobile-nav-link">WebGAL</a>
                <a href="https://github.com/open-webgal/WebGAL" class="mobile-nav-link" target="_blank">GitHub</a>
            </nav>
        </div>

        <main class="main-content">
            <div id="game-list" class="game-grid">
                <div class="loading">正在载入游戏库...</div>
            </div>
        </main>

        <footer class="layout-footer">
            <p>© 2025 庇护所计划. All rights reserved.</p>
        </footer>

        <nav id="bottom-nav" class="mobile-bottom-nav">
            <button class="mobile-nav-btn" onclick="window.history.back()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 12H5M12 19l-7-7 7-7" /></svg>
            </button>
            <button class="mobile-nav-btn" onclick="location.reload()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15" /></svg>
            </button>
            <button class="mobile-nav-btn" id="menu-toggle-bottom">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12h18M3 6h18M3 18h18" /></svg>
            </button>
        </nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const gameListContainer = document.getElementById('game-list');
            const header = document.getElementById('header');
            const bottomNav = document.getElementById('bottom-nav');
            const menuToggle = document.getElementById('menu-toggle');
            const menuToggleBottom = document.getElementById('menu-toggle-bottom');
            const menuDrawer = document.getElementById('menu-drawer');
            const menuOverlay = document.getElementById('menu-overlay');
            const hamburger = document.querySelector('.hamburger');

            // 滚动隐藏逻辑
            let lastScrollY = window.scrollY;
            window.addEventListener('scroll', () => {
                const currentScrollY = window.scrollY;
                if (currentScrollY > lastScrollY && currentScrollY > 100) {
                    header.classList.add('nav-hidden');
                    bottomNav.classList.add('nav-hidden');
                } else {
                    header.classList.remove('nav-hidden');
                    bottomNav.classList.remove('nav-hidden');
                }
                lastScrollY = currentScrollY;
            });

            // 菜单切换逻辑
            const toggleMenu = () => {
                menuDrawer.classList.toggle('open');
                menuOverlay.classList.toggle('show');
                hamburger.classList.toggle('active');
            };

            menuToggle.addEventListener('click', toggleMenu);
            menuToggleBottom.addEventListener('click', toggleMenu);
            menuOverlay.addEventListener('click', toggleMenu);

            try {
                const response = await fetch('games.json');
                const data = await response.json();
                const games = data.games;
                
                gameListContainer.innerHTML = '';
                
                games.forEach(game => {
                    let folderName = game.id.replace(/-/g, '');
                    let gamePath = `games/${folderName}/index.html`;
                    let coverUrl = '';
                    if (game.assets && game.assets.cover) {
                        const cleanPath = game.assets.cover.startsWith('/') ? game.assets.cover.substring(1) : game.assets.cover;
                        coverUrl = `games/${folderName}/${cleanPath}`;
                    }

                    const card = document.createElement('div');
                    card.className = 'game-card';
                    card.onclick = () => window.location.href = gamePath;
                    
                    const tagsHtml = (game.tags || [])
                        .filter(tag => tag && tag.trim() !== '')
                        .map(tag => `<span class="tag">${tag}</span>`)
                        .join(' ');

                    card.innerHTML = `
                        <div class="game-cover-container">
                            <img src="${coverUrl}" class="game-cover" onerror="this.src='https://via.placeholder.com/320x180?text=Cover'">
                        </div>
                        <div class="game-info">
                            <div class="game-title">${game.display_name}</div>
                            <div class="game-tags">${tagsHtml}</div>
                            <div class="game-description">${game.description}</div>
                            <div class="game-footer">
                                <span class="game-author">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px; vertical-align: middle;"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                    ${game.author}
                                </span>
                            </div>
                        </div>
                    `;
                    gameListContainer.appendChild(card);
                });
            } catch (e) {
                gameListContainer.innerHTML = '<div class="error">加载失败</div>';
            }
        });
    </script>
</body>
</html>
